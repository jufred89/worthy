<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.CampingMapper">
	<!-- 유저 메인 페이지 지역, 날짜 조건 캠핑장 목록 -->
	<select id="campSearchList" resultType="hashmap">
	select c.*, r.* from
	(select * from view_camp_sql where camp_addr like concat('%',#{camp_addr},'%')) c
	left join
	(select camp_id, count(*) reserve_cnt from tbl_camp_reserve
	where (reser_checkin between #{reser_checkin} and #{reser_checkout}) or
	(reser_checkout between #{reser_checkin} and #{reser_checkout}) group by camp_id) r
	on c.camp_id= r.camp_id order by c.camp_id desc
	</select>
	<!-- 특정 날짜에 특정 캠핑장에 예약가능한 캠핑장 스타일 목록 -->
	<select id="campAvailableReser" resultType="hashmap">
	select c.*,r.* from
    (select tcs.camp_id,tcs.style_no,tcs.style_qty,tcs.style_price,tsn.style_name from tbl_camp_style as tcs, tbl_style_name as tsn where tcs.camp_id=#{camp_id} and tcs.style_no=tsn.style_no) c
    left join
	(select  *,count(camp_room_no) as reser_count
    from tbl_camp_reserve
    where camp_id=#{camp_id} and(
			(reser_checkin between #{reser_checkin} and #{reser_checkout}) 
         or (reser_checkout between  #{reser_checkin} and #{reser_checkout}) 
		 or (reser_checkin <![CDATA[<]]> #{reser_checkin} and reser_checkout <![CDATA[>]]> #{reser_checkout}) ) group by camp_room_no) r on c.style_no=right(r.camp_room_no,1) order by c.camp_id desc
	</select>
	<!-- 관리자 페이지 캠핑장 목록 -->
 	<select id="campList" resultType="com.example.domain.CampingVO">
 		select * from tbl_camp_list
 		<if test="searchType=='camp_id'">
			where camp_id like concat('%',#{keyword},'%')
			order by camp_id desc
			limit #{pageStart},#{perPageNum}
		</if>
		<if test="searchType=='camp_name'">
			where camp_name like concat('%',#{keyword},'%')
			order by camp_id desc
			limit #{pageStart},#{perPageNum}
		</if>
		<if test="searchType=='camp_addr'">
			where camp_addr like concat('%',#{keyword},'%')
			order by camp_id desc
			limit #{pageStart},#{perPageNum}
		</if>
 	</select>
 	<!-- 캠핑장 시설명 리스트 -->
 	<select id="campFacilityList" resultType="com.example.domain.CampingFacilityVO">
 		select * from tbl_facility_name
 	</select>
 	<!-- 캠핑장 스타일명 리스트 -->
 	<select id="campStyleList" resultType="com.example.domain.CampingStyleVO">
 		select * from tbl_Style_name
 	</select>
 	<!-- 캠핑장 정보 페이지 -->
 	<select id="campRead" resultType="com.example.domain.CampingVO">
 		select * from tbl_camp_list where camp_id=#{camp_id}
 	</select>
 	<!-- 특정 캠핑장 스타일 정보 읽어오기 -->
 	<select id="campStyleRead" resultType="com.example.domain.CampingVO">
 		select camp_id,style_name,style_qty,style_price from tbl_camp_style as cs, tbl_style_name as sn
		where cs.style_no = sn.style_no and camp_id=#{camp_id};
 	</select>
 	<!-- 특정 캠핑장 시설 정보 읽어오기 -->
 	<select id="campFacilityRead" resultType="com.example.domain.CampingVO">
		select camp_id,facility_name from tbl_camp_facility as cf, tbl_facility_name as fn
		where cf.facility_no = fn.facility_no and camp_id=#{camp_id};
 	</select>
 	<!-- 캠핑장 등록시 camp_id 최대값 읽어오기 -->
 	<select id="maxCode" resultType="string">
 		select max(camp_id) from tbl_camp_list
 	</select>
 	<!-- 캠팡정 둥록 -->
 	<insert id="campInsert">
 		insert into tbl_camp_list(camp_id,camp_name,camp_maker,camp_addr,camp_tel,camp_detail,camp_memo,camp_price,camp_image)
 		values(#{camp_id},#{camp_name},#{camp_maker},#{camp_addr},#{camp_tel},#{camp_detail},#{camp_memo},#{camp_price},#{camp_image})
 	</insert>
 	<!-- 특정 캠핑장 시설목록 등록 -->
 	<insert id="campFacilityInsert">
 		insert into tbl_camp_facility(camp_id,facility_no)
 		values(#{camp_id},#{facility_no})
 	</insert>
 	<!-- 특정 캠핑장 스타일목록 등록 -->
 	<insert id="campStyleInsert">
 		insert into tbl_camp_style(camp_id,style_no,style_qty,style_price)
 		values(#{camp_id},#{style_no},#{style_qty},#{style_price})
 	</insert>
 	<!-- 총 캠핑장 갯수 -->
 	<select id="campTotcount" resultType="int">
		select count(*) from tbl_camp_list
		<if test="searchType=='camp_id'">
			where camp_id like concat('%',#{keyword},'%')
		</if>
		<if test="searchType=='camp_name'">
			where camp_name like concat('%',#{keyword},'%')
		</if>
		<if test="searchType=='camp_addr'">
			where camp_addr like concat('%',#{keyword},'%')
		</if>
	</select>
	<!-- 캠핑장 예약 -->
	<insert id="campReservationCheckoutInsert">
		insert into tbl_camp_reserve(camp_id,camp_room_no,reser_status,reser_checkin,reser_checkout,uid)
		values(#{camp_id},#{camp_room_no},'1',#{reser_checkin},#{reser_checkout},#{uid});
	</insert>
	<select id="campSlide" resultType="hashmap">
select * from tbl_camp_list
order by camp_id desc

</select>
</mapper>