<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.ShopMapper">
 	<select id="prod_list" resultType="hashmap">
 		select *, format(prod_normalprice, 0) prod_normalprice_f from tbl_shop_product
 		<if test="keyword != null">
 			where prod_name like concat("%", #{keyword}, "%") || prod_detail like concat("%", #{keyword}, "%")
 		</if>
 		<if test="searchType == 'desc'">
 			order by prod_id desc
 		</if>
 		<if test="searchType == 'price'">
 			order by prod_normalprice
 		</if>
 		<if test="searchType == 'price_desc'">
 			order by prod_normalprice desc
 		</if>
 		limit #{pageStart}, #{perPageNum}
 	</select>
 	
 	<select id="prod_read" resultType="com.example.domain.ShopVO">
 		select * from tbl_shop_product
 		where prod_id = #{prod_id}
 	</select>
 	
 	<select id="totalCount" resultType="int">
 		select count(*) from tbl_shop_product
 		<if test="keyword != null">
 			where prod_name like concat("%", #{keyword}, "%") || prod_detail like concat("%", #{keyword}, "%")
 		</if>
 	</select>
 	
 	<insert id="prod_insert">
 		insert into tbl_shop_product(prod_id, prod_name, prod_comp, prod_normalprice, prod_detail, prod_image, 
 		prod_cap, prod_mfd, prod_exp)
		values(#{prod_id}, #{prod_name}, #{prod_comp}, #{prod_normalprice}, #{prod_detail}, #{prod_image},
		#{prod_cap}, #{prod_mfd}, #{prod_exp})
 	</insert>
 	
 	<update id="prod_update">
 		update tbl_shop_product set prod_name=#{prod_name}, prod_comp=#{prod_comp}, prod_normalprice=#{prod_normalprice}, 
 		prod_saleprice=#{prod_saleprice}, prod_detail=#{prod_detail}, prod_image=#{prod_image}, prod_cap=#{prod_cap},
 		prod_mfd=#{prod_mfd}, prod_exp=#{prod_exp}
 		where prod_id=#{prod_id}
 	</update>
 	
 	<select id="prod_maxID" resultType="String">
 		select max(prod_id) from tbl_shop_product
 	</select>
 	
 	<select id="prod_delete">
 		delete from tbl_shop_product where prod_id = #{prod_id}
 	</select>
 	
 	
 	
 	<insert id="att_insert">
 		insert into tbl_shop_attach(shop_ano, shop_pid)
 		values(#{shop_ano}, #{shop_pid})
 	</insert>
 	
 	<select id="attach" resultType="com.example.domain.AttachVO">
 		select * from tbl_shop_attach
 		where shop_pid = #{shop_pid}
 	</select>
 	
 	<select id="att_update">
 		update tbl_shop_attach set shop_ano = #{shop_ano}
 		where shop_pid = #{shop_pid}
 	</select>
 	
 	
 	
 	<select id="pre_list" resultType="HashMap">
 		select *, date_format(prod_r_regdate, '%Y-%m-%d') prod_r_regdate_f from tbl_shop_preview
 		where prod_rid = #{prod_rid}
 		order by prod_rno desc
 		limit #{cri.pageStart}, #{cri.perPageNum}
 	</select>
 	
 	<insert id="pre_insert">
 		insert into tbl_shop_preview(prod_ruid, prod_rstar, prod_review, prod_rid)
		values(#{prod_ruid}, #{prod_rstar}, #{prod_review}, #{prod_rid})
 	</insert>
 	
 	<select id="pre_totalCount" resultType="int">
 		select count(*) from tbl_shop_preview
 		where prod_rid = #{prod_id}
 	</select>
 	
 	<delete id="pre_delete">
 		delete from tbl_shop_preview
 		where prod_rno = #{prod_rno}
 	</delete>



 	<select id="prod_slide" resultType="HashMap">
 		select *, format(prod_normalprice, 0) prod_normalprice_f from tbl_shop_product
 		order by prod_id desc
 		limit 0, 8
 	</select>
 	
 	
 	
 	<insert id="cart_insert">
 		insert into tbl_shop_cart(cart_pid, cart_uid, cart_price, cart_pqty, cart_status, cart_pimage, cart_pname)
 		values(#{cart_pid}, #{cart_uid}, #{cart_price}, #{cart_pqty}, #{cart_status}, #{cart_pimage}, #{cart_pname})
 	</insert>
 	
 	<select id="cart_list" resultType="HashMap">
 		select * from tbl_shop_cart
 		where cart_uid = #{cart_uid} and cart_status = 1
 		order by cart_no desc
 	</select>
 	
 	<update id="cart_delete">
 		update tbl_shop_cart set cart_status = '3'
 		where cart_no = #{cart_no}
 	</update>
 	
 	<select id="cart_price_sum" resultType="int">
 		select sum(cart_price) from tbl_shop_cart
 		where cart_uid = #{cart_uid}
 	</select>
 	
 	
 	<insert id="pay_insert">
 		insert into tbl_shop_payment(pay_no, pay_price, pay_type, pay_uid, pay_status, deli_postno, deli_address1,
 		deli_address2, deli_tel, deli_name, deli_memo)
 		values(#{pay_no}, #{pay_price}, #{pay_type}, #{pay_uid}, #{pay_status}, #{deli_postno}, 
 		#{deli_address1}, #{deli_address2}, #{deli_tel}, #{deli_name}, #{deli_memo})
 	</insert>
 	
 	<insert id="order_insert">
 		insert into tbl_shop_order(order_id, cart_no)
 		values(#{order_id}, #{cart_no})
 	</insert>
</mapper>